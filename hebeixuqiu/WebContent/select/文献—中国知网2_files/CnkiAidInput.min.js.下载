function InitAidInput(b,c){var a=[{value:"主题",key:"SU",desc:"主题描述信息"},{value:"题名",key:"TI",desc:"相关描述信息"},{value:"关键词",key:"KY",desc:"相关描述信息"},{value:"摘要",key:"AB",desc:"相关描述信息"},{value:"全文",key:"FT",desc:"相关描述信息"},{value:"作者",key:"AU",desc:"相关描述信息"},{value:"第一责任人",key:"FI",desc:"相关描述信息"},{value:"机构",key:"AF",desc:"相关描述信息"},{value:"文献来源",key:"JN",desc:"相关描述信息"},{value:"参考文献",key:"RF",desc:"相关描述信息"},{value:"年份",key:"YE",desc:"相关描述信息"},{value:"基金",key:"FU",desc:"相关描述信息"},{value:"中图分类号",key:"CLC",desc:"相关描述信息"},{value:"ISSN",key:"SN",desc:"相关描述信息"},{value:"统一刊号",key:"CN",desc:"相关描述信息"},{value:"ISBN",key:"IB",desc:"相关描述信息"},{value:"被引频次",key:"CF",desc:"相关描述信息"}];if($("#"+c)){keyValArrs=[];words=$.trim($("#"+c).text().replace(/，/g,",")).split(",");if(words&&words.length>0){for(i=0;i<words.length;i++){keyVal=words[i].split("=");if(keyVal&&keyVal.length==2){keyValArrs[keyValArrs.length]={key:keyVal[0],value:keyVal[1],desc:keyVal[1]}}}}if(keyValArrs.length>0){a=keyValArrs}}$("#"+b).unbind();$("#"+b).autocomplete(a,{max:100,width:200,scrollHeight:1000,matchContains:true,tip:"请输入专业检索表达式",url:"http://app.cnki.net/Parts/Suggest/GetForJquery",formatItem:function(f,e,d){if(f.option=="url"){return f.key}return f.key+(f.value==""?"":" = "+f.value)},formatMatch:function(f,e,d){return f.key},formatResult:function(d){return d.key}}).result(function(e,f,d){})}(function(a){a.fn.extend({autocomplete:function(b,c){c=a.extend({},a.Autocompleter.defaults,{data:b,delay:20,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(d){return d};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new a.Autocompleter(this,c)})},result:function(b){return this.bind("result",b)},search:function(b){return this.trigger("search",[b])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(b){return this.trigger("setOptions",[b])},unautocomplete:function(){return this.trigger("unautocomplete")}});a.Autocompleter=function(H,t){var m=[{value:"",key:"AND",desc:"与/并且"},{value:"",key:"OR",desc:"或"},{value:"",key:"NOT",desc:"非"}];var s=[{value:"",key:"%",desc:"模糊"},{value:"",key:"=",desc:"精确"}];var l=[{value:"",key:"$ N",desc:'检索词出现N次。 举例：TI="转基因 $ 2"'},{value:"",key:"/AFT N",desc:'同句，按词序出现，间隔大于N个词。 举例：AB="转基因 /AFT 5 水稻"'},{value:"",key:"/NEAR N",desc:'同句，间隔小于N个词。 举例：AB="转基因 /NEAR 5 水稻"'},{value:"",key:"/PEG N",desc:'全文，词间隔小于N段。 举例：AB="转基因 /PEG 5 水稻"'},{value:"",key:"/PREV N",desc:'同句，按词序出现，间隔小于N个词。 举例：AB="转基因 /PREV 5 水稻"'},{value:"",key:"/SEN N",desc:'同段，按次序出现，间隔小于N句。 举例：FT="转基因 /SEN 0水稻"'},{value:"",key:"/SUB N",desc:'第N位包含检索词。 举例：AU="刘强 /SUB 1 "'}];var x=t.data;var z=false;var E={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,CTRL:17,ALT:18,SHIFT:16,CAPSLOCK:20};var g=[{key:"dc:title",desc:"标题",value:"|TI|JN|"},{key:"dc:creator",desc:"作者",value:"|FI|TU|AU|"},{key:"dc:contributor",desc:"机构",value:"|AF|"},{key:"dc:publisher",desc:"出版单位",value:"||"},{key:"dc:source",desc:"来源",value:"|RF|"},{key:"dc:subject",desc:"主题",value:"|SU|KY|AB|FT|"}];var u="dc:subject";var C=a(H).attr("autocomplete","off").addClass(t.inputClass);var k;var e="";var v=a.Autocompleter.Cache(t);var A=0;var G;var K;var B={mouseDownOnSelect:false};var p=a.Autocompleter.Select(t,H,F,B);var w;if(C.val()==""){C.val(t.tip);C.css("color","#999999")}var M=(!!window.opr&&!!opr.addons)||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;M&&a(H.form).bind("submit.autocomplete",function(){if(w){w=false;return false}});C.bind((M?"keypress":"keydown")+".autocomplete",function(N){G=N.keyCode;if(N.ctrlKey||N.altKey){return}switch(N.keyCode){case E.UP:if(p.visible()){N.preventDefault();p.prev()}break;case E.DOWN:if(p.visible()){N.preventDefault();p.next()}break;case E.PAGEUP:N.preventDefault();if(p.visible()){p.pageUp()}else{d(0,true)}break;case E.PAGEDOWN:N.preventDefault();if(p.visible()){p.pageDown()}else{d(0,true)}break;case t.multiple&&a.trim(t.multipleSeparator)==","&&E.COMMA:case E.TAB:case E.RETURN:if(p.visible()){N.preventDefault()}if(F()){w=true;return false}break;case E.CAPSLOCK:case E.ESC:N.preventDefault();p.hide();break;case E.BACKSPACE:default:clearTimeout(k);k=setTimeout(d,t.delay);break}}).focus(function(){if(a.trim(C.val())==t.tip){C.val("");C.css("color","#000000")}A++}).blur(function(){A=0;if(!B.mouseDownOnSelect){J()}setTimeout(function(){if(a.trim(C.val())==""){C.val(t.tip);C.css("color","#999999")}},200)}).click(function(){}).bind("search",function(){var N=(arguments.length>1)?arguments[1]:null;function O(S,Q){var P;if(Q&&Q.length){for(var R=0;R<Q.length;R++){if(Q[R].result.toLowerCase()==S.toLowerCase()){P=Q[R];break}}}if(typeof N=="function"){N(P)}else{C.trigger("result",P&&[P.data,P.value])}}a.each(I(C.val()),function(Q,P){n(P,O,O)})}).bind("flushCache",function(){v.flush()}).bind("setOptions",function(){a.extend(t,arguments[1]);if("data" in arguments[1]){v.populate()}}).bind("unautocomplete",function(){p.unbind();C.die();a(H.form).die(".autocomplete")});function F(){var Q=p.selected();if(!Q){return false}var U=Q.result;e=U;var P=(U=="''"||U=="()")?true:false;if(U=="="||U=="%"){U+=" ''";P=true}if(true){var R=y(C);var O=C.val().substring(0,R);var S=C.val().substring(R);var N=I(O);if(N.length){var T=r(N[N.length-1],false);U=N.slice(0,N.length-1).join(t.multipleSeparator)+t.multipleSeparator+T+U;R=U.length;U=U+S}else{R=U.length}}C.val(U);c(H,P?R-1:R);L();C.trigger("result",[Q.data,Q.value]);return true}function d(N,O){if(G==E.DEL){p.hide();return}currentValue=C.val();K=y(C);currentValue=currentValue.substring(0,K);e=currentValue;h(e);currentValue=o(currentValue);if(!currentValue||currentValue.length>=t.minChars){C.addClass(t.loadingClass);if(currentValue&&!t.matchCase){currentValue=currentValue.toLowerCase()}n(currentValue,q,L)}else{b();p.hide()}}function I(N){if(!N){return[""]}var P=N.split(t.multipleSeparator);var O=[];a.each(P,function(R,Q){O[R]=Q});return O}function r(O,N){regex=new RegExp("=|'","igm");i=0;while(regex.test(O)){if(regex.lastIndex>0){i=regex.lastIndex}}if(N){return O.substring(i)}else{return O.substring(0,i)}}function D(){value="";currentValue=C.val();K=y(C);currentValue=currentValue.substring(0,K).replace(new RegExp("=","igm")," ").replace(new RegExp("'","igm")," ");regex=new RegExp("\\s+(not|and|or\\s+)","igm");lindex=0;while(regex.test(currentValue)){if(regex.lastIndex>0){lindex=regex.lastIndex}}currentValue=currentValue.substring(lindex);words=I(currentValue);if(words&&words.length>0){regex=new RegExp("\\s*([a-z][A-Z])+\\s*","igm");for(N=0;N<words.length;N++){if(regex.test(words[N])){value=words[N]}}}if(value==""){return u}for(var N=0;N<g.length;N++){if(g[N].value.lastIndexOf("|"+value+"|")>-1){return g[N].key}}return u}function o(N){if(!t.multiple){return N}var O=I(N);return O[O.length-1]}function y(R){R.focus();if(R&&R.context&&R.context.selectionStart>=0){return R.context.selectionStart}else{var O=document.selection.createRange();var Q=O.duplicate();R.select();var N=document.selection.createRange();var P=0;while(Q.compareEndPoints("StartToStart",N)>0){Q.moveStart("character",-1);P++}O.select();return P}}function c(P,N){if(P.selectionStart){P.selectionStart=N;P.selectionEnd=N}else{var O=P.createTextRange();O.moveStart("character",N);O.collapse(true);O.select()}}function h(P){P=P.replace(/\(|\)/g,"");lindex=0;var O=new RegExp("\\s+(not|and|or\\s+)","igm");while(O.test(P)){if(O.lastIndex>0){lindex=O.lastIndex}}P=P.substring(lindex);if(new RegExp("(((%|=)\\s*'\\s*)$)|(((%|=)\\s*)$)|(((%|=)\\s*'\\s*[^']+\\s*)$)","igm").test(P)){var N=o(currentValue);if(N==""){z=false;t.data=l;v.flush();v.populate();return}if(new RegExp("(/\\w+\\s+[N|n|\\d+]$)|(\\$\\s+[N|n|\\d+]$)","igm").test(currentValue)){t.data=null;v.flush();v.populate();return}z=true;v.flush();v.populate();return}else{z=false}if(new RegExp("(((%|=)\\s*'\\s*.*\\s*'\\s*)$)|(((%|=)\\s*.+\\s*)$)","igm").test(P)){t.data=m;v.flush();v.populate();return}if(new RegExp("^\\s*(\\S+)\\s+$","igm").test(P)){t.data=s;v.flush();v.populate();return}if(new RegExp("^\\s*\\S+$","igm").test(P)||a.trim(P)==""){t.data=x;v.flush();v.populate();return}t.data=null;v.flush();v.populate()}function j(O,N){if(t.autoFill&&(o(C.val()).toLowerCase()==O.toLowerCase())&&G!=E.BACKSPACE){C.val(C.val()+N.substring(o(e).length));a.Autocompleter.Selection(H,e.length,e.length+N.length)}}function J(){clearTimeout(k);k=setTimeout(L,200)}function L(){var N=p.visible();p.hide();clearTimeout(k);b();if(t.mustMatch){C.search(function(O){if(!O){if(t.multiple){var P=I(C.val()).slice(0,-1);C.val(P.join(t.multipleSeparator)+(P.length?t.multipleSeparator:""))}else{C.val("")}}})}if(N){return false}}function q(O,N){if(N&&N.length&&A){b();p.display(N,O);j(O,N[0].value);p.show()}else{L()}}function n(Q,N,O){var R;if(Q==undefined){Q=""}else{if(!t.matchCase){Q=Q.toLowerCase()}}var R=v.load(Q);var P=a.trim(r(Q,true));if(R&&R.length&&!z){N(Q,R)}else{if((typeof t.url=="string")&&(t.url.length>0)&&z&&P!=""&&P!="'"){a.each(t.extraParams,function(S,T){extraParams[S]=typeof T=="function"?T():T});a.ajax({type:"get",url:t.url,dataType:"jsonp",data:{source:"kms",item:D(),text:P,domain:"www.cnki.net"},success:function(T){var S=t.parse&&t.parse(T)||f(T);N(Q,S)},error:function(){}})}else{p.emptyList();O(Q)}}}function f(P){if(P&&P.length>0){var O=[];for(var N=0;N<P.length;N++){O[O.length]={data:{value:P[N],key:P[N],option:"url",desc:P[N]},value:P[N],result:P[N]}}return O}else{p.emptyList();return null}}function b(){C.removeClass(t.loadingClass)}};a.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:0,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(b){return b[0]},formatMatch:null,autoFill:false,width:100,multiple:true,multipleSeparator:" ",highlight:function(b,c){return b.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+c.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:180,tip:""};a.Autocompleter.Cache=function(f){var h={};var g=0;function b(k,j){if(!f.matchCase){k=k.toLowerCase()}var l=k.indexOf(j);if(l==-1){return false}return l==0||f.matchContains}function d(k,j){if(g>f.cacheLength){c()}if(!h[k]){g++}h[k]=j}function e(){if(!f.data){return false}var m={},o=0;if(!f.url){f.cacheLength=1}m[""]=[];for(var j=0,k=f.data.length;j<k;j++){var q=f.data[j];q=(typeof q=="string")?[q]:q;var l=f.formatMatch(q,j+1,f.data.length);if(l===false){continue}var p=l.charAt(0).toLowerCase();if(!m[p]){m[p]=[]}var n={value:l,data:q,result:f.formatResult&&f.formatResult(q)||l};m[p].push(n);if(o++<f.max){m[""].push(n)}}a.each(m,function(s,r){f.cacheLength++;d(s,r)})}setTimeout(e,25);function c(){h={};g=0}return{flush:c,add:d,populate:e,load:function(o){if(!f.cacheLength||!g){return null}if(!f.url&&f.matchContains){var j=[];for(var n in h){if(n.length>0){var l=h[n];a.each(l,function(p,k){if(o==""){j.push(k)}else{if(b(k.value,o)){j.push(k)}}})}}return j}else{if(h[o]){return h[o]}else{if(f.matchSubset){for(var m=o.length-1;m>=f.minChars;m--){var l=h[o.substr(0,m)];if(l){var j=[];a.each(l,function(p,k){if(b(k.value,o)){j[j.length]=k}});return j}}}}}return null}}};a.Autocompleter.Select=function(c,r,q,b){var m={ACTIVE:"ac_over"};var l,f=-1,e,t="",d=true,k,p;function o(){if(!d){return}k=a("<div/>").hide().addClass(c.resultsClass).css("position","absolute").appendTo(document.body);p=a("<ul/>").appendTo(k).mouseover(function(u){if(s(u).nodeName&&s(u).nodeName.toUpperCase()=="LI"){f=a("li",p).removeClass(m.ACTIVE).index(s(u));a(s(u)).addClass(m.ACTIVE)}}).click(function(u){a(s(u)).addClass(m.ACTIVE);q();r.focus();return false}).mousedown(function(){b.mouseDownOnSelect=true}).mouseup(function(){b.mouseDownOnSelect=false});if(c.width>0){k.css("width",c.width)}d=false}function s(u){var v=u.target;while(v&&v.tagName!="LI"){v=v.parentNode}if(!v){return[]}return v}function h(u){l.slice(f,f+1).removeClass(m.ACTIVE);g(u);var v=l.slice(f,f+1).addClass(m.ACTIVE);if(c.scroll){var w=0;l.slice(0,f).each(function(){w+=this.offsetHeight});if((w+v[0].offsetHeight-p.scrollTop())>p[0].clientHeight){p.scrollTop(w+v[0].offsetHeight-p.innerHeight())}else{if(w<p.scrollTop()){p.scrollTop(w)}}}}function g(u){f+=u;if(f<0){f=l.size()-1}else{if(f>=l.size()){f=0}}}function j(u){return c.max&&c.max<u?c.max:u}function n(){p.empty();var x=j(e.length);for(var w=0;w<x;w++){if(!e[w]){continue}var u=c.formatItem(e[w].data,w+1,x,e[w].value,t);if(u===false){continue}var v=a("<li title='"+e[w].data.desc+"'/>").html(c.highlight(u,t)).addClass(w%2==0?"ac_even":"ac_odd").appendTo(p)[0];a.data(v,"ac_data",e[w])}l=p.find("li");if(c.selectFirst){l.slice(0,1).addClass(m.ACTIVE);f=0}if(a.fn.bgiframe){p.bgiframe()}}return{display:function(u,v){o();e=u;t=v;n()},next:function(){h(1)},prev:function(){h(-1)},pageUp:function(){if(f!=0&&f-8<0){h(-f)}else{h(-8)}},pageDown:function(){if(f!=l.size()-1&&f+8>l.size()){h(l.size()-1-f)}else{h(8)}},hide:function(){k&&k.hide();l&&l.removeClass(m.ACTIVE);f=-1},visible:function(){return k&&k.is(":visible")},current:function(){return this.visible()&&(l.filter("."+m.ACTIVE)[0]||c.selectFirst&&l[0])},show:function(){var v,x;if(document.selection){a(r).focus();var u=document.selection.createRange();x=u.offsetTop+20;v=u.offsetLeft+10}else{var y=a(r).offset();x=y.top+r.offsetHeight;v=y.left}k.css({width:typeof c.width=="string"||c.width>0?c.width:a(r).width(),top:x,left:v}).show();if(c.scroll){p.scrollTop(0);p.css({maxHeight:c.scrollHeight,overflow:"auto"});if(ISIE&&typeof document.body.style.maxHeight==="undefined"){var z=0;l.each(function(){z+=this.offsetHeight});var w=z>c.scrollHeight;p.css("height",w?c.scrollHeight:z);if(!w){l.width(p.width()-parseInt(l.css("padding-left"))-parseInt(l.css("padding-right")))}}}},selected:function(){var u=l&&l.filter("."+m.ACTIVE).removeClass(m.ACTIVE);return u&&u.length&&a.data(u[0],"ac_data")},emptyList:function(){p&&p.empty()},unbind:function(){k&&k.remove()}}};a.Autocompleter.Selection=function(e,c,d){if(e.createTextRange){var b=e.createTextRange();b.collapse(true);b.moveStart("character",c);b.moveEnd("character",d);b.select()}else{if(e.setSelectionRange){e.setSelectionRange(c,d)}else{if(e.selectionStart){e.selectionStart=c;e.selectionEnd=d}}}}})(jQuery);